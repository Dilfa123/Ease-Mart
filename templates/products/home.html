{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ThriftHome – Used Items Marketplace</title>

  <script src="https://cdn.tailwindcss.com?plugins=forms"></script>

  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: "#13c8ec",
            bgsoft: "#f6f8f8"
          },
          fontFamily: {
            display: ["Work Sans", "sans-serif"]
          }
        }
      }
    }
  </script>
</head>

<body class="bg-bgsoft font-display text-slate-800">


<!-- ================= HEADER ================= -->
<header class="bg-white sticky top-0 z-50 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 py-3 flex items-center justify-between">

    <!-- LOGO -->
    <h1 class="text-2xl font-bold text-primary">ThriftHome</h1>

    <!-- RIGHT ICONS -->
    <div class="flex items-center gap-4">

      <!-- CART -->
     <div class="flex items-center gap-5">

  <!-- MY ORDERS -->
  <a href="{% url 'order_items' %}"
     class="text-sm font-semibold text-slate-700 hover:text-primary">
    My Orders
  </a>

  <!-- CART -->
  <a href="{% url 'cart_products' %}" class="relative">
    <span class="material-symbols-outlined text-3xl">
      shopping_cart
    </span>
    {% if cart_count %}
    <span class="absolute -top-1 -right-2 bg-red-600 text-white text-xs px-1.5 rounded-full">
      {{ cart_count }}
    </span>
    {% endif %}
  </a>

  <!-- USER PROFILE -->
  <a href="{% url 'user_detail' %}"
     class="h-10 w-10 rounded-full bg-gray-100 flex items-center justify-center hover:bg-gray-200">
    <span class="material-symbols-outlined text-2xl text-primary">
      person
    </span>
  </a>

</div>


      <!-- AUTH -->
      {% if request.user.is_authenticated %}
        <a href="{% url 'logout' %}"
           class="text-sm text-red-600 font-semibold">
          Logout
        </a>
      {% else %}
        <a href="{% url 'login' %}" class="text-sm font-semibold">Login</a>
      {% endif %}

    </div>

  </div>
</header>
<!-- ================= SEARCH & FILTER ================= -->
<section class="max-w-7xl mx-auto px-4 mt-8">
  <form method="get"
        class="bg-white p-4 rounded-2xl shadow flex flex-col md:flex-row gap-4 items-center">

    <!-- SEARCH -->
    <input type="text"
           name="q"
           value="{{ request.GET.q }}"
           placeholder="Search products or categories..."
           class="w-full md:flex-1 rounded-lg border px-4 py-2 focus:ring-primary focus:border-primary">

    <!-- CATEGORY FILTER -->
    <select name="category"
            class="w-full md:w-52 rounded-lg border px-3 py-2">
      <option value="">All Categories</option>
      {% for c in cat %}
        <option value="{{ c.id }}"
                {% if selected_cat_id|default:'' == c.id|stringformat:"s" %}
                  selected
                {% endif %}>
          {{ c.name }}
        </option>
      {% endfor %}
    </select>

    <!-- SORT -->
    <select name="sort"
            class="w-full md:w-44 rounded-lg border px-3 py-2">
      <option value="">Sort By</option>
      <option value="High price" {% if request.GET.sort == 'High price' %}selected{% endif %}>
        Price: Low → High
      </option>
      <option value="Low price" {% if request.GET.sort == 'Low price' %}selected{% endif %}>
        Price: High → Low
      </option>
      <option value="name asc" {% if request.GET.sort == 'name asc' %}selected{% endif %}>
        Name A → Z
      </option>
      <option value="name dec" {% if request.GET.sort == 'name dec' %}selected{% endif %}>
        Name Z → A
      </option>
    </select>

    <!-- SUBMIT -->
    <button type="submit"
            class="bg-primary text-white px-6 py-2 rounded-lg font-semibold">
      Apply
    </button>

  </form>
</section>

<!-- ================= HERO ================= -->
<section class="max-w-7xl mx-auto px-4 mt-6">
  <div class="bg-primary text-white rounded-3xl p-8 flex flex-col md:flex-row items-center gap-8">
    <div class="flex-1">
      <h2 class="text-4xl font-bold mb-3 leading-tight">
        Buy & Sell Pre-Loved Household Items
      </h2>
      <p class="opacity-90 mb-6 max-w-lg">
        Save money and reduce waste by buying quality second-hand products.
      </p>
      <a href="#products"
         class="inline-block bg-white text-primary px-7 py-3 rounded-full font-semibold">
        Browse Products
      </a>
    </div>
    <img src="{% static 'images/hero.png' %}" class="w-64 hidden md:block">
  </div>
</section>

<!-- ================= CATEGORIES ================= -->
<section class="max-w-7xl mx-auto px-4 mt-12">
  <h2 class="text-xl font-bold mb-5">Shop by Category</h2>

  <div class="grid grid-cols-3 sm:grid-cols-5 md:grid-cols-7 gap-4">
    {% for c in cat %}
    <a href="{% url 'category' c.id %}"
       class="bg-white rounded-2xl p-4 shadow hover:shadow-md transition text-center">
      <span class="material-symbols-outlined text-primary text-4xl">category</span>
      <p class="mt-2 text-sm font-medium truncate">{{ c.name }}</p>
    </a>
    {% endfor %}
  </div>
</section>

<!-- ================= PRODUCTS ================= -->
<section id="products" class="max-w-7xl mx-auto px-4 mt-14 pb-28">
  <h2 class="text-xl font-bold mb-6">Latest Products</h2>

  <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-5">

    {% for product in products %}
    <div class="bg-white rounded-2xl shadow hover:shadow-lg transition overflow-hidden">

      <!-- SQUARE IMAGE -->
      <a href="{% url 'user_single_product' product.id %}">
        <div class="aspect-square bg-gray-100 overflow-hidden">
          <img src="{{ product.image.url }}"
               class="w-full h-full object-cover hover:scale-105 transition">
        </div>
      </a>

      <!-- DETAILS -->
      <div class="p-3">
        <h3 class="text-sm font-medium truncate mb-1">
          {{ product.title }}
        </h3>

        <div class="flex items-center justify-between">
          <p class="text-primary font-bold text-base">
            ₹{{ product.price }}
          </p>
          <a href="{% url 'user_single_product' product.id %}"
             class="text-xs bg-primary text-white px-3 py-1 rounded-full">
            View
          </a>
        </div>
      </div>
    </div>
    {% endfor %}

  </div>

  <!-- PAGINATION -->
   
  {% if page_obj.paginator.num_pages > 1 %}
  <div class="flex justify-center mt-10 gap-2 flex-wrap">
    {% for num in page_obj.paginator.page_range %}
      {% if page_obj.number == num %}
        <span class="px-3 py-1 bg-primary text-white rounded-full">{{ num }}</span>
      {% else %}
       <a href="?q={{ request.GET.q }}&sort={{ request.GET.sort }}&category={{ selected_cat_id }}&page={{ num }}"
   class="px-3 py-1 bg-white border rounded-full">
  {{ num }}
</a>

      {% endif %}
    {% endfor %}
  </div>
  {% endif %}
</section>

<!-- ================= BOTTOM NAV ================= -->
<nav class="fixed bottom-0 left-0 right-0 bg-white border-t h-14 flex justify-around items-center md:hidden">
  <a href="{% url 'home' %}">
    <span class="material-symbols-outlined text-3xl text-primary">home</span>
  </a>
  <a href="{% url 'cart_products' %}">
    <span class="material-symbols-outlined text-3xl text-primary">shopping_cart</span>
  </a>
  <a href="{% url 'user_detail' %}">
    <span class="material-symbols-outlined text-3xl text-primary">person</span>
  </a>
</nav>

</body>
</html>
